<!DOCTYPE html>
<html lang="ja">
    <head prefix="og: http://ogp.me/ns# website: http://ogp.me/ns/website#">
        <meta charset="UTF-8">
        <!--文字コードは上のほうにないとすべておしまいになるらしい-->
        <meta name="description" content="カードゲーム作りたい">
        <title>JUN汁ｗおもちゃばこ。/おもちゃ/しゅうくんカード</title>
        <!--OGPとかいうの-->
        <meta property="og:site_name" content="JUN汁ｗおもちゃばこ。/omocha/syuukun_card">                                <!--タイトル　入力すること！-->
        <meta property="og:title" content="しゅうくんカード">                                                               <!--タイトル　入力すること！-->
        <meta property="og:type" content="article"> <!--websiteはトップページ、articleが記事だってさ-->
        <meta property="og:url" content="https://junjiruw.github.io/DEYUTI/omocha/syuukun_card.html">                   <!--リンク　入力すること！-->
        <meta property="og:image" content="https://github.com/junjiruw/DEYUTI/blob/master/images/site/junjiruw_bako.png?raw=true">
        <meta name="twitter:card" content="summary"><!--なにを表示するか-->
        <meta name="twitter:site" content="@junjiruw"><!--フッターに表示されるらしい…どこ？-->
        <link rel="stylesheet" href="../css/style.css">
        
        <link rel="icon" href="../images/site/favicon32.png">
        <style>

            div#mannaka{
                width: 98%;
                margin: auto;
                background: #16151a;
                border: 2px solid #ffffff;
                color: #ffffff;   
                font-size: 16px;    
            }

            div#parent_div{
                text-align: center;
                margin: 10px;
            }
            canvas{
                background: #ffffff;
                height: 70vh;/*これ、PCブラウザで横に狭くしたら崩壊せえへん？→勝手に崩壊してろ*/
                /*image-rendering: pixelated;ドット絵を拡大したいなら使え*/
            }


            div#buttons{
                display: flex;
            }
            input.key_button{
                background-color: #FFFFFF;
                width: 1.5em;
                height: 1.5em;
                font-size: 2em;
                font-family: "misaki_gothic";
                margin: 0.25em;
                margin-left: 1em;
            }
            input.key_button:active{
                background-color: #656965;
                color: #FFFFFF;
            }
            div#button_left{
                text-align: left;
                width: 50%;
            }
            div#button_left div{
                text-align: center;
            }
            div#button_right{
                text-align: center;
                width: 50%;
            }

        </style>
        <script src="../js/public.js"></script>
        <script>
            //素材読み込み
            var test=new Image();
            test.src="../images/omocha/syuukun_card/200130.png";
            var yamahuda=new Image();
            yamahuda.src="../images/omocha/syuukun_card/yamahuda.png";
            var hakaba=new Image();
            hakaba.src="../images/omocha/syuukun_card/hakaba64.png";
            var card_basyo=new Image();
            card_basyo.src="../images/omocha/syuukun_card/card_basyo.png";
            var yubi=new Image();
            yubi.src="../images/omocha/syuukun_card/ka-soru64.png";//嘘。拡大したから128
            //カード定義 effectを使うときはeffect()
            var test_card={name:"テストカード",image:test,ATK:0,HP:0,state:["monster","test"],effect:function(){console.log("name:"+this.name);},text:"オイラはテストカード！真っ赤な赤色がトレードマークさ！"};
            var test_card2={name:"テストカード2",image:test,ATK:0,HP:0,state:["monster","test"],effect:function(){console.log("name:"+this.name);},text:"オイラはテストカード！真っ赤な赤色がトレードマークさ！"};
            //ここにゲームパラメータを置くとイイネ。
            var my_deck=[];
            for(let i=0;i<40;i++){
                my_deck[i]={card:test_card,ATK:0,HP:0,state:[],position:"my_yamahuda"};
            }
            var teki_deck=[];
            for(let i=0;i<40;i++){
                teki_deck[i]={card:test_card,ATK:0,HP:0,state:[],position:"teki_yamahuda"};
            }
            var my_tehuda=[];
            for(let i=0;i<5;i++){
                my_tehuda[i]=my_deck[i];
                my_tehuda[i].position="my_tehuda_"+i;
            }
            var my_ba=["","","","",""];
            for(let i=0;i<5;i++){
                my_ba[i]=my_deck[i+5];
                my_ba[i].position="my_ba_"+i;
            }
            var my_ba_num=5;
            var teki_ba=["","","","",""];
            for(let i=0;i<2;i++){
                teki_ba[i]=teki_deck[i];
                teki_ba[i].position="teki_ba_"+i;
            }
            var teki_ba_num=5;
            //キーボードなど、システムの、あの、アレ、アレさ！
            var key_input="";
            var what_input="";//キーボード同時おしに使う
            var key_interval=0;//n*10[s]　長押しの連続入力に使ってる
            var key_owarasete=0;

            var carsor=0;
            var time=0;

            onload = function(){
                onload_functions();
                const cnvs = document.getElementById('cnvs');//IDを指定して変数にぶち込む
                const ctx = cnvs.getContext("2d");
                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。

                if (navigator.userAgent.match(/iPhone|Android.+Mobile/)) {//貴様！スマホで見ているな！？
                    cnvs.style.width=100+"%";
                    cnvs.style.height=cnvs.clientWidth+"px";
                }

                var buttons = document.getElementsByClassName("key_button");//ボタン操作
                if( window.ontouchstart === null ){ // 注：ontouchstartが存在しない時は undefined が返る
                    //ようするにタッチ機能がある端末なら
                    for(let i=0;i<buttons.length;i++){
                        buttons[i].addEventListener("touchstart",function(e){//押すと動く
                            e.preventDefault();//ボタンをもとの状態に戻してください（血涙）
                            key_input=this.value;
                            key_interval=-1;//初回限定モード（1回は動作させたいので。）
                            key_owarasete=0;
                        });
                        buttons[i].addEventListener("touchend",function(e){//離すと動く
                            e.preventDefault();//ボタンをもとの状態に戻してください（血涙）
                            if(key_interval!=-1){//一回も実行されてないのに終了するのはボタンとしておかしいので、はじく
                                key_input="";
                                key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                            }else{
                                key_owarasete=1;//一度も実行されてないけど、ボタンはもう押してないのよ。
                            }
                        });
                    }
                }else{
                    //一般的なPCなら
                    for(let i=0;i<buttons.length;i++){
                        buttons[i].addEventListener("mousedown",function(){//押すと動く
                            key_input=this.value;
                            key_interval=-1;//初回限定モード（1回は動作させたいので。）
                            key_owarasete=0;
                        });
                        buttons[i].addEventListener("mouseup",function(){//離すと動く
                            if(key_interval!=-1){//一回も実行されてないのに終了するのはボタンとしておかしいので、はじく
                                key_input="";
                                key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                            }else{
                                key_owarasete=1;//一度も実行されてないけど、ボタンはもう押してないのよ。
                            }
                        });

                    }
                }
                
                document.addEventListener('keydown', function(key){//キーボード操作

                    what_input="";
                    if(key.key=="w" || key.key=="k" || key.key=="ArrowUp"){
                        what_input="↑";
                    }else if(key.key=="a" || key.key=="h" || key.key=="ArrowLeft"){
                        what_input="←";
                    }else if(key.key=="d" || key.key=="l" || key.key=="ArrowRight"){
                        what_input="→";
                    }else if(key.key=="s" || key.key=="j" || key.key=="ArrowDown"){
                        what_input="↓";
                    }else if(key.key=="Enter"){
                        what_input="〇";
                    }else if(key.key=="Shift"){
                        what_input="×";
                    }
                    if(key_input.indexOf(what_input)==-1){//すでに押されていたら、文字列検索でひっかかる。ひっかからないなら-1が帰ってくる
                        key_input=key_input+what_input;//キーボードは同時押しが可能なので書き換えではなく、追加にします。え？キーボードとボタン同時押しされたら？バ～カ
                    }
                    if (what_input != ""){key.preventDefault();}//矢印キーでの操作時に、画面が上下にスクロールしてしまうことを防ぐ

                    
                });
                document.addEventListener('keyup', function(key){//キーボード操作
                    what_input="";
                    if(key.key=="w" || key.key=="ArrowUp"){
                        what_input="↑";
                    }else if(key.key=="a" || key.key=="ArrowLeft"){
                        what_input="←";
                    }else if(key.key=="d" || key.key=="ArrowRight"){
                        what_input="→";
                    }else if(key.key=="s" || key.key=="ArrowDown"){
                        what_input="↓";
                    }else if(key.key=="Enter"){
                        what_input="〇";
                    }else if(key.key=="Shift"){
                        what_input="×";
                    }
                    
                    key_input=key_input.slice(0,key_input.indexOf(what_input))+key_input.slice(key_input.indexOf(what_input)+1);//該当文字を消去
                    if(key_input==""){
                        key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                    }
                });
                //--------------------------------------------------------------------------------------------------------
                setInterval(function(){//1秒にn回動くぞ！
                    time+=1;
                    if(time==1000){
                        time=0;
                    }

                    if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=3;//30*n/1000[s]の間、長押しでの連続入力を無効。
                            for(let i=0;i<key_input.length;i++){
                                if(key_input.charAt(i)=="↑"){
                                    if(carsor==6){
                                        carsor=0;
                                    }else if(carsor==11){
                                        carsor=5;
                                    }else if(carsor>=7 && carsor<=15){
                                        carsor-=1;
                                    }else if(carsor>=16){
                                        carsor=10;
                                    }
                                }else if(key_input.charAt(i)=="←"){
                                    if(carsor==0){
                                    }else if(carsor<=5){ 
                                       carsor-=1;
                                    }else if(carsor>=11 && carsor<=15){
                                        carsor-=5;
                                    }else if(carsor>=17){
                                        carsor-=1;
                                    }
                                }else if(key_input.charAt(i)=="→"){
                                    if(carsor<=4){
                                        carsor+=1;
                                    }else if(carsor==5){
                                        
                                    }else if(carsor>=6 && carsor<=10){
                                        carsor+=5;
                                    }else if(carsor>=16 && carsor<=(my_tehuda.length+14)){
                                        carsor+=1;
                                    }
                                }else if(key_input.charAt(i)=="↓"){
                                    if(carsor<=2){
                                        carsor=6;
                                    }else if(carsor<=5){
                                        carsor=11;
                                    }else if(carsor<=9){
                                        carsor+=1;
                                    }else if(carsor==10){
                                        carsor=16;
                                    }else if(carsor<=15){
                                        carsor+=1;
                                    }
                                }else if(key_input.charAt(i)=="〇"){
                                    
                                }else if(key_input.charAt(i)=="×"){
                                }
                            }
                            if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                key_input="";
                                key_interval=0;
                            }
                        }else if(key_interval>0){
                            key_interval=key_interval-1;//カウントダウン
                        }


                    ctx.fillStyle="rgb(130,255,170)";
                    ctx.fillRect(0,0,1000,1000);
                    ctx.drawImage(card_basyo,0,0);

                    if(my_ba_num=!0){//ここで自分のフィールドにカードを並べる
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        for(let i=0;i<my_ba.length;i++){
                            if(my_ba[i].position=="my_ba_0"){
                                ctx.drawImage(my_ba[i].card.image,105,-205);
                            }else if(my_ba[i].position=="my_ba_1"){
                                ctx.drawImage(my_ba[i].card.image,240,-215);
                            }else if(my_ba[i].position=="my_ba_2"){
                                ctx.drawImage(my_ba[i].card.image,375,-225);
                            }else if(my_ba[i].position=="my_ba_3"){
                                ctx.drawImage(my_ba[i].card.image,510,-215);
                            }else if(my_ba[i].position=="my_ba_4"){   
                                ctx.drawImage(my_ba[i].card.image,645,-205);
                            }
                        }
                        ctx.restore();
                    }
                    

                    if(teki_ba_num=!0){//ここで敵のフィールドにカードを並べる
                        ctx.save();
                        ctx.rotate(270 * Math.PI / 180);
                        for(let i=0;i<teki_ba.length;i++){
                            if(teki_ba[i].position=="teki_ba_0"){
                                ctx.drawImage(teki_ba[i].card.image,-235,795);
                            }else if(teki_ba[i].position=="teki_ba_1"){
                                ctx.drawImage(teki_ba[i].card.image,-370,785);
                            }else if(teki_ba[i].position=="teki_ba_2"){
                                ctx.drawImage(teki_ba[i].card.image,-505,775);
                            }else if(teki_ba[i].position=="teki_ba_3"){
                                ctx.drawImage(teki_ba[i].card.image,-640,785);
                            }else if(teki_ba[i].position=="teki_ba_4"){
                                ctx.drawImage(teki_ba[i].card.image,-775,795);
                            }
                            
                        }
                        ctx.restore();
                    }
                    

                    ctx.fillStyle="rgb(0,0,0)";//上のほうを描いてます。
                    ctx.fillRect(5,5,490,90);
                    ctx.fillRect(505,5,490,90);
                    ctx.fillStyle="rgb(255,255,255)";
                    ctx.fillRect(10,10,480,80);
                    ctx.fillRect(510,10,480,80);
                    ctx.fillStyle="rgb(150,200,255)";
                    ctx.fillRect(288,12,200,76);
                    ctx.fillRect(788,12,200,76);
                    ctx.fillStyle="rgb(0,0,0)";
                    ctx.drawImage(yamahuda,10,20);
                    ctx.fillText("40", 74, 70);
                    ctx.drawImage(yamahuda,510,20);
                    ctx.fillText("40", 574, 70);
                    ctx.drawImage(hakaba,174,20);
                    ctx.fillText("0", 238, 70);
                    ctx.drawImage(hakaba,674,20);
                    ctx.fillText("0", 738, 70);

                    ctx.save();//ここから手札
                    ctx.fillStyle="rgb(0,0,0)";
                    ctx.fillRect(5,785,990,210);
                    ctx.fillStyle="rgb(255,255,255)";
                    ctx.fillRect(10,790,980,200);
                    tehuda_maisuu=my_tehuda.length;
                    if(tehuda_maisuu<7){
                        card_kankaku=130;
                    }else{
                        card_kankaku=850/tehuda_maisuu;
                    }
                    kakudo=25/tehuda_maisuu;
                    ctx.rotate(10 * Math.PI / 180);
                    ctx.drawImage(test,50*Math.cos(10 * Math.PI / 180)+780*Math.sin(10 * Math.PI / 180),780*Math.cos(10 * Math.PI / 180)-50*Math.sin(10 * Math.PI / 180));
                    for (let i=1;i<tehuda_maisuu;i++){
                        ctx.rotate(kakudo * Math.PI / 180);
                        ctx.drawImage(test,(50+card_kankaku*i)*Math.cos((10+i*kakudo) * Math.PI / 180)+780*Math.sin((10+i*kakudo) * Math.PI / 180),780*Math.cos((10+i*kakudo) * Math.PI / 180)-(50+card_kankaku*i)*Math.sin((10+i*kakudo) * Math.PI / 180));
                    }
                    ctx.restore();
                    
                    //カーソル表示…
                    if(carsor==0){  ctx.drawImage(yubi,10,80+4*Math.sin(time*Math.PI/8)); //左上
                    }else if(carsor==1){    ctx.drawImage(yubi,160,80+4*Math.sin(time*Math.PI/8));
                    }else if(carsor==2){    ctx.drawImage(yubi,300,80+4*Math.sin(time*Math.PI/8));

                    }else if(carsor==3){ ctx.drawImage(yubi,510,80+4*Math.sin(time*Math.PI/8));//右上
                    }else if(carsor==4){ctx.drawImage(yubi,660,80+4*Math.sin(time*Math.PI/8));
                    }else if(carsor==5){ctx.drawImage(yubi,800,80+4*Math.sin(time*Math.PI/8));


                    }else if(carsor==6){//左場
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        ctx.drawImage(yubi,105,-100+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                    }else if(carsor==7){
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        ctx.drawImage(yubi,245,-110+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                    }else if(carsor==8){
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        ctx.drawImage(yubi,375,-120+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                    }else if(carsor==9){
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        ctx.drawImage(yubi,510,-110+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                    }else if(carsor==10){
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        ctx.drawImage(yubi,645,-100+4*Math.sin(time*Math.PI/8));
                        ctx.restore();

                    }else if(carsor==11){//右ば
                        ctx.save();
                        ctx.rotate(270 * Math.PI / 180);
                        ctx.drawImage(yubi,-235,900+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                    }else if(carsor==12){
                        ctx.save();
                        ctx.rotate(270 * Math.PI / 180);
                        ctx.drawImage(yubi,-370,910+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                    }else if(carsor==13){
                        ctx.save();
                        ctx.rotate(270 * Math.PI / 180);
                        ctx.drawImage(yubi,-505,920+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                    }else if(carsor==14){
                        ctx.save();
                        ctx.rotate(270 * Math.PI / 180);
                        ctx.drawImage(yubi,-640,910+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                    }else if(carsor==15){
                        ctx.save();
                        ctx.rotate(270 * Math.PI / 180);
                        ctx.drawImage(yubi,-775,900+4*Math.sin(time*Math.PI/8));
                        ctx.restore();

                    }else{//手札でヤンス。
                        ctx.save();
                        ctx.rotate((10+kakudo*(carsor-16)) * Math.PI / 180);
                        ctx.drawImage(yubi,(50+card_kankaku*(carsor-16))*Math.cos((10+(carsor-16)*kakudo) * Math.PI / 180)+780*Math.sin((10+(carsor-16)*kakudo) * Math.PI / 180),100+4*Math.sin(time*Math.PI/8)+780*Math.cos((10+(carsor-16)*kakudo) * Math.PI / 180)-(50+card_kankaku*(carsor-16))*Math.sin((10+(carsor-16)*kakudo) * Math.PI / 180));
                        ctx.restore();
                    }
                    
                },30);//30/1000[s]でくりかえすぞ！
                
            }
            
        </script>
    </head>
    <body>


        <div id="top"></div>
        <header id="header">
            <button onclick="html_link_btn()" id="html_link_btn"></button>
            <nav id="html_link_nav">
                <ul id="html_link_ul"></ul>
            </nav>
            <a href="../index.html">
                <img id="go_home" src="../images/site/omotyabako_deka.png" alt="トップページへ" height="1px"><!--ここで高さを入れておかないと、クソでかい画像が一瞬読み込まれてボタンの大きさが暴走する-->
            </a>
            <h1 id="title_h1">
                JUN汁ｗおもちゃばこ。
            </h1>
        </header>

        <div id="mannaka">

            
            
            <div id="parent_div">
                <canvas id="cnvs" height="1000px" width="1000px"><!--styleのheigthは見た目の大きさを変えているにすぎない。表示領域はcssじゃない。-->
                </canvas>
            </div>
            <div id="buttons">
                <div id="button_left">
                    <div>
                        <input type="button" class="key_button" value="↑">
                    </div>
                    <div>
                        <input type="button" class="key_button" value="←">
                        <input type="button" class="key_button" value="→">
                    </div>
                    <div>
                        <input type="button" class="key_button" value="↓">
                    </div>
                    
                </div>
                <div id="button_right">
                    <input type="button" class="key_button" value="〇">
                    <input type="button" class="key_button" value="×">
                </div>
            </div>

            <footer>
                <ul id="footul">
                    <li id="foot_tweet_li">
                        <a href="" id="foot_tweet_a"><!--onload_functions()でhrefを書き込んでるで！-->
                            <img src="../images/site/twitterbutton.gif" alt="ツイートボタン" id="tweet_img">
                        </a>
                    </li>
                    <li>
                        <a href="#top" id="totop"> 
                            ページ上部に移動
                        </a>
                    </li>
                </ul>
            </footer>
        </div>
    </body>
</html>
