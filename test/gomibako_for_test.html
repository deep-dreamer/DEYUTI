<!DOCTYPE html>
<html lang="ja">
    <head prefix="og: http://ogp.me/ns# website: http://ogp.me/ns/website#">
        <meta charset="UTF-8">
        <!--文字コードは上のほうにないとすべておしまいになるらしい-->
        <meta name="description" content="技術的なテストをしている">
        <title>JUN汁ｗおもちゃばこ。/TEST</title>
        <!--OGPとかいうの-->
        <meta property="og:site_name" content="JUN汁ｗおもちゃばこ。/TEST">
        <meta property="og:title" content="テスト用ページ"/>
        <meta property="og:type" content="website"/> <!--websiteはトップページだってさ-->
        <meta property="og:url" content="https://junjiruw.github.io/DEYUTI/test/gomibako_for_test"/>
        <meta property="og:image" content="https://github.com/junjiruw/DEYUTI/blob/master/images/site/junjiruw_bako.png?raw=true"/>
        <meta name="twitter:card" content="summary"><!--なにを表示するか-->
        <meta name="twitter:site" content="@junjiruw"><!--フッターに表示されるらしい…どこ？-->
        <link rel="stylesheet" href="../css/style.css">
        
        <link rel="icon" href="../images/site/favicon32.png">
        <style>
            body {
                background-image:url("../images/site/junjiruw_pro.png"),
                url("../images/site/junjiruw_pro_rev.png"),
                linear-gradient(#053a24,80%,#000000);
                
                background-size:10% 120%,10% 120%,auto;
                background-position: -2% 70%, 102% 0%;/*0%で画像の左が画面端。100%で右が画面端*/
                background-repeat:no-repeat,no-repeat,repeat;
                background-attachment: fixed,fixed,fixed;
                image-rendering: pixelated;/*ドット絵を拡大したいなら使え*/
            }
            div#mannaka{
                border-image: linear-gradient(rgba(255,255,255,1), rgba(0,30,100,1));/*透明は黒になるっぽいね*/
                border-image-slice: 1;
                background:linear-gradient(rgba(22,21,26,1), rgba(22,21,26,0.6));
            }
            footer{
                background:linear-gradient(rgba(4,29,66,0.6), rgba(4,29,66,0));
            }
            div#table{
                display: table;
                padding: 1px;
                background:#0f4936;
            }
            div#table p{
                display: table-row;
                background:#0f4936;
                padding: 1px;
            }
            div#table img{
                margin: 1px;
                display: table-cell;
                display: inline;
            }
            div#parent_div{
                text-align: center;
                margin: 10px;
            }
            canvas{
                background: #ffffff;
                height: 70vh;/*これ、PCブラウザで横に狭くしたら崩壊せえへん？→勝手に崩壊してろ*/
            }
            div#buttons{
                display: flex;
            }
            input.key_button{
                width: 1.5em;
                height: 1.5em;
                font-size: 2em;
                margin: 0.25em;
            }
            input.key_button:active{
                background-color: #656965;
                color: #FFFFFF;
            }
            div#button_left{
                text-align: left;
                width: 50%;
            }
            div#button_left div{
                text-align: center;
            }
            div#button_right{
                text-align: center;
                width: 50%;
            }

        </style>
        <script src="../js/public.js"></script>
        <script>
        var ctx; 
        var img;
        var deyu_x=0;
        var deyu_y=0;
        var key_input="";
        var key_interval=0;//n*10[s]　長押しの連続入力に使ってる
        var key_owarasete=0;

            onload = function(){
                onload_functions();
                const cnvs = document.getElementById('cnvs');//IDを指定して変数にぶち込む
                
                if (navigator.userAgent.match(/iPhone|Android.+Mobile/)) {//貴様！スマホで見ているな！？
                    cnvs.style.width=90+"%";
                    console.log(cnvs.clientWidth);
                    cnvs.style.height=cnvs.clientWidth+"px";
                    console.log(cnvs.clientHeight);
                }

                ctx = cnvs.getContext("2d");
                // 画像読み込み
                img= new Image();
                img.src = "../images/site/favicon32.png";  // 画像のURLを指定


                var buttons = document.getElementsByClassName("key_button");//ボタン操作
                if( window.ontouchstart === null ){ // 注：ontouchstartが存在しない時は undefined が返る
                    //ようするにタッチ機能がある端末なら
                    for(let i=0;i<buttons.length;i++){
                        buttons[i].addEventListener("touchstart",function(){//押すと動く
                            key_input=this.value;
                            key_interval=-1;//初回限定モード（1回は動作させたいので。）
                            key_owarasete=0;
                        });
                        buttons[i].addEventListener("touchend",function(){//離すと動く
                            if(key_interval!=-1){//一回も実行されてないのに終了するのはボタンとしておかしいので、はじく
                                key_input="";
                                key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                            }else{
                                key_owarasete=1;//一度も実行されてないけど、ボタンはもう押してないのよ。
                            }
                        });
                    }
                }else{
                    //一般的なPCなら
                    for(let i=0;i<buttons.length;i++){
                        buttons[i].addEventListener("mousedown",function(){//押すと動く
                            key_input=this.value;
                            key_interval=-1;//初回限定モード（1回は動作させたいので。）
                            key_owarasete=0;
                        });
                        buttons[i].addEventListener("mouseup",function(){//離すと動く
                            if(key_interval!=-1){//一回も実行されてないのに終了するのはボタンとしておかしいので、はじく
                                key_input="";
                                key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                            }else{
                                key_owarasete=1;//一度も実行されてないけど、ボタンはもう押してないのよ。
                            }
                        });

                    }
                }

                document.addEventListener('keydown', function(key){//キーボード操作
                    if(key.key=="w" || key.key=="ArrowUp"){
                        key_input="↑";
                    }else if(key.key=="a" || key.key=="ArrowLeft"){
                        key_input="←";
                    }else if(key.key=="d" || key.key=="ArrowRight"){
                        key_input="→";
                    }else if(key.key=="s" || key.key=="ArrowDown"){
                        key_input="↓";
                    }else if(key.key=="Enter"){//AがAで入力できない！？←だってWASDに使ってるんだもん…
                        key_input="〇";
                    }else if(key.key=="Shift"){
                        key_input="×";dawds
                    }
                });
                document.addEventListener('keyup', function(key){//キーボード操作
                    key_input="";//二つのキーを押していると…
                    //1キーを押す→2キーを押す（この時点で1キーの情報消滅）
                    //つまり配列で持っておいて、自分のが終わったら消す（天才）
                    key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                    //じゃあこっちも配列でもつべきなんか…？
                });
            }

            setInterval(function(){//1秒に100回動くぞ！
                if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                    key_interval=10;//100/1000[s]の間、長押しでの連続入力を無効。
                    if(key_input=="↑"){
                        deyu_y=deyu_y-16;
                    }else if(key_input=="←"){
                        deyu_x=deyu_x-16;
                    }else if(key_input=="→"){
                        deyu_x=deyu_x+16;
                    }else if(key_input=="↓"){
                        deyu_y=deyu_y+16;
                    }else if(key_input=="〇"){
                        deyu_x=0;
                    }else if(key_input=="×"){
                        deyu_y=0;
                    }
                    if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                        key_input="";
                        key_interval=0;
                    }
                }else if(key_interval>0){
                    key_interval=key_interval-1;//カウントダウン
                }
                CLEAR_cnvs();
                ctx.drawImage(img,deyu_x,deyu_y);
            }, 10);//10/1000[s]でくりかえすぞ！

            function CLEAR_cnvs(){//キャンバスを白く塗るだけの精霊
                ctx.fillStyle="#FFFFFF";
                ctx.fillRect(0,0,320,320);
            }

            
        </script>
    </head>
    <body>
        <div id="top"></div>
        <header id="header">
            <button onclick="html_link_btn()" id="html_link_btn"></button>
            <nav id="html_link_nav">
                <ul id="html_link_ul"></ul>
            </nav>
            <a href="../index.html">
                <img id="go_home" src="../images/site/omotyabako_deka.png" alt="トップページへ height="1px"><!--ここで高さを入れておかないと、クソでかい画像が一瞬読み込まれてボタンの大きさが暴走する-->
            </a>
            <h1 id="title_h1">
                JUN汁ｗおもちゃばこ。
            </h1>
        </header>

        <div id="mannaka">
            このページはテスト用です。

            <div id="parent_div">
                <canvas id="cnvs" height="320px" width="320px"><!--styleのheigthは見た目の大きさを変えているにすぎない。表示領域はcssじゃない。-->
                </canvas>
            </div>
            <div id="buttons">
                <div id="button_left">
                    <div>
                        <input type="button" class="key_button" value="↑">
                    </div>
                    <div>
                        <input type="button" class="key_button" value="←">
                        <input type="button" class="key_button" value="→">
                    </div>
                    <div>
                        <input type="button" class="key_button" value="↓">
                    </div>
                    
                </div>
                <div id="button_right">
                    <input type="button" class="key_button" value="〇">
                    <input type="button" class="key_button" value="×">
                </div>
            </div>
            <p>
                キーボード<br>移動:WASD,↑←→↓ <br>〇:Enter, ×:Shift
            </p>            
            

            <footer>
                <ul id="footul">
                    <li id="foot_tweet_li">
                        <a href="" id="foot_tweet_a"><!--onload_functions()でhrefを書き込んでるで！-->
                            <img src="../images/site/twitterbutton.gif" alt="ツイートボタン" id="tweet_img">
                        </a>
                    </li>
                    <li>
                        <a href="#top" id="totop"> 
                            ページ上部に移動
                        </a>
                    </li>
                </ul>
            </footer>
        </div>
    </body>
</html>
